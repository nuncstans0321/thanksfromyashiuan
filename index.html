<!DOCTYPE html><html lang="zh-Hant"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>感謝卡 — v9.4.0</title>
<style>
:root{--r:22px;--card:#f2f3f5;--ink:#1f2328;--gap:12px}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",Arial,sans-serif;background:#0e0e10;color:var(--ink);display:flex;align-items:center;justify-content:center;overflow:hidden}
.stage{width:min(980px,96vw);height:min(780px,96svh)}@supports not (height:1svh){.stage{height:min(780px,96vh)}}
.card{position:relative;width:100%;height:100%;background:var(--card);border-radius:var(--r);overflow:hidden;box-shadow:0 28px 60px rgba(0,0,0,.25),0 8px 18px rgba(0,0,0,.12),inset 0 0 0 1px rgba(0,0,0,.08)}
.page{position:absolute;inset:0;padding:20px;display:grid;place-items:center;opacity:0;transform:translateY(8px);transition:.3s}
.page.active{opacity:1;transform:none}
#p1,#p2,#p4{padding:0}
#p3{display:block;overflow:auto;-webkit-overflow-scrolling:touch;padding:12px}
.vbox{position:relative;width:100%;height:100%;background:#000;border-radius:var(--r);overflow:hidden;display:flex;align-items:center;justify-content:center}
.vbox video{width:100%;height:100%;object-fit:contain;background:#000;display:block}
/* Next */
.next{position:fixed;right:calc(2vw + 8px);bottom:calc(2vh + 8px);padding:.7rem 1.05rem;border-radius:999px;border:1px solid #0002;background:#ffd24a;font-weight:800;z-index:60;display:none}
.next.show{display:inline-block}
/* p2 ribbon */
.p2ribbon{position:absolute;top:10px;left:50%;transform:translateX(-50%);background:#fff;border:1px solid #f2c94c;border-radius:12px;padding:6px 10px;font-weight:800;z-index:2;white-space:nowrap;max-width:95%;overflow:hidden;text-overflow:ellipsis;font-size:18px}
@media (max-width:480px){.p2ribbon{font-size:16px}}
/* p3 */
.gridArea{height:100%;display:grid;grid-template-rows:auto 1fr;gap:var(--gap)}
.banner{display:flex;gap:.5em;justify-content:center;align-items:center;background:#fff7d9;border:1px solid #f2c94c;border-radius:12px;padding:10px;font-weight:900}
.gridHold{position:relative}
.grid4{position:absolute;inset:0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr);gap:var(--gap)}
.badge{background:#fff;border:1px solid #0001;border-radius:14px;padding:8px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.06);outline:0;touch-action:manipulation;display:grid;grid-template-rows:1fr auto;min-height:0}
.badge:focus{box-shadow:0 0 0 3px #3b82f6aa}
.thumb{width:100%;height:100%;border-radius:10px;overflow:hidden;background:#fff;display:grid;place-items:center}
.thumb img{width:100%;height:100%;object-fit:contain;display:block}
/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;z-index:80;padding:16px}
.modal.show{display:grid}
.mcard{width:min(720px,92vw);max-height:90svh;background:#fff;border-radius:18px;box-shadow:0 18px 48px rgba(0,0,0,.35);display:grid;grid-template-rows:auto 1fr auto;overflow:hidden}
.mhead{padding:14px 18px;border-bottom:1px solid #eee}
.mhead h3{margin:0 0 6px 0;font-size:20px}
.mhead p{margin:0;color:#555}
.mplay{position:relative;background:#0f1220;display:grid;place-items:center;min-height:240px}
.mplay .bg{position:absolute;inset:0;background-size:cover;background-position:center;opacity:.28;filter:blur(2px)}
.mplay .content{position:relative;padding:14px;color:#fff;display:grid;gap:12px;justify-items:center}
.pbar{width:min(520px,80%);height:12px;border:1px solid #2f3a5d;background:#0f1220;border-radius:999px;overflow:hidden}
.fill{width:0;height:100%;background:linear-gradient(90deg,#5146ff,#ffd54a);transition:width 1.1s}
.fullTag{display:none;margin-top:6px;background:#2a233f;color:#fff;font-size:12px;padding:4px 10px;border-radius:999px}
.face{font-size:60px}
.stamp{margin-top:6px;border:2px dashed #7ec3ff;color:#7ec3ff;font-weight:800;border-radius:8px;padding:4px 8px;opacity:0;transform:scale(.9);transition:.3s}
.shield{background:#24352a;color:#bff5cf;border:1px solid #3e6b4f;border-radius:10px;padding:6px 10px;opacity:0;transform:translateY(6px);transition:.3s}
.box{width:240px;height:150px;background:linear-gradient(180deg,#7a1f19,#6a1712);border:2px solid #a93b2f;border-radius:10px;position:relative}
.lid{position:absolute;width:115%;height:24px;background:linear-gradient(180deg,#c44a3c,#a83e33);border:2px solid #a93b2f;border-bottom:none;border-radius:12px 12px 6px 6px;top:-22px;left:-7%;transform-origin:left center;transition:.35s}
.ribbonY{position:absolute;width:14px;height:100%;left:50%;top:0;transform:translateX(-50%);background:linear-gradient(180deg,#ffd54a,#f9b84a)}
.burst{position:absolute;left:50%;top:-30px;transform:translateX(-50%);font-size:28px;opacity:0;transition:.35s}
.note{position:absolute;left:50%;top:-48px;transform:translateX(-50%);background:#fff;color:#333;padding:6px 10px;border-radius:8px;font-size:12px;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,.35);opacity:0;transition:.25s}
.open .lid{transform:rotate(-22deg) translateY(-6px)}.open .burst{opacity:1;transform:translateX(-50%) translateY(-6px)}
.mfoot{padding:12px 18px;border-top:1px solid #eee;display:flex;justify-content:center}
.btn{border:1px solid #0002;background:#ffd24a;border-radius:999px;padding:.6rem 1.0rem;font-weight:800;cursor:pointer}
/* Toast / spark */
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#1e2433;border:1px solid #334063;color:#e8ebff;padding:8px 12px;border-radius:10px;opacity:0;transition:.25s;pointer-events:none;z-index:90}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
.spark{position:fixed;font-size:18px;animation:rise .65s ease-out forwards;pointer-events:none;z-index:85}
@keyframes rise{from{transform:translateY(0) scale(1);opacity:1}to{transform:translateY(-26px) scale(1.2);opacity:0}}
</style>
</head><body>
<div class="stage"><div class="card">
  <!-- p1 -->
  <section class="page active" id="p1">
    <div class="vbox"><video id="vIntro" playsinline webkit-playsinline muted preload="auto" poster="poster.png"><source id="sIntro" src="envelope_open.mp4" type="video/mp4"></video></div>
    <button class="next" id="n1">下一頁</button>
  </section>
  <!-- p2 -->
  <section class="page" id="p2">
    <div class="vbox">
      <div class="p2ribbon" id="ribbon">給博皓學長 ～ by 62 期學員亞璇</div>
      <video id="vAscii" playsinline webkit-playsinline muted preload="auto" loop><source id="sAscii" src="ascii_anim.mp4" type="video/mp4"></video>
    </div>
    <button class="next show" id="n2">下一頁</button>
  </section>
  <!-- p3 -->
  <section class="page" id="p3">
    <div class="gridArea">
      <div class="banner">亞璇的祝福派送中，<span class="sub">任選一份今日 Buff，點一下領取 ✨</span></div>
      <div class="gridHold"><div class="grid4" id="grid4">
        <div class="badge" id="b1" role="button" tabindex="0"><div class="thumb"><img src="slot1.png" alt="能量瓶"></div></div>
        <div class="badge" id="b2" role="button" tabindex="0"><div class="thumb"><img src="slot2.png" alt="好天氣"></div></div>
        <div class="badge" id="b3" role="button" tabindex="0"><div class="thumb"><img src="slot3.png" alt="花束"></div></div>
        <div class="badge" id="b4" role="button" tabindex="0"><div class="thumb"><img src="slot4.png" alt="禮物"></div></div>
      </div></div>
    </div>
    <button class="next show" id="n3">下一頁</button>
  </section>
  <!-- p4 -->
  <section class="page" id="p4">
    <div class="vbox" id="finalBox"><video id="vFinale" playsinline webkit-playsinline muted preload="auto"><source id="sFinale" src="finale.mp4" type="video/mp4"></video>
      <div id="overlay" style="position:absolute;inset:0;display:none;place-items:center;background:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,.35));z-index:40">
        <div class="overlay-card" style="background:#fff;border-radius:16px;padding:18px 22px;box-shadow:0 14px 40px rgba(0,0,0,.35);text-align:center">
          <div class="jp" style="font-weight:900;font-size:clamp(22px,6.8vw,42px);margin-bottom:8px;">ありがとうございます</div>
          <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
            <button class="btn" id="againBtn">再一次</button>
            <button class="btn" id="shareBtn" style="background:#fff">分享</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div></div>

<!-- modal for p3 -->
<div class="modal" id="modal">
  <div class="mcard">
    <div class="mhead"><h3 id="mTitle"></h3><p id="mSub"></p></div>
    <div class="mplay"><div class="bg" id="mBg"></div><div class="content" id="mContent"></div></div>
    <div class="mfoot"><button class="btn" id="mClose">✨ pika~</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
(function(){
  const $=s=>document.querySelector(s), t=$("#toast");
  const bust=Date.now().toString(36);
  ["#sIntro","#sAscii","#sFinale"].forEach(sel=>{const el=$(sel); if(el){el.src=el.getAttribute("src")+"?v="+bust;}});
  document.querySelectorAll("img").forEach(img=>{const src=img.getAttribute("src"); if(src) img.setAttribute("src", src+(src.includes("?")?"&":"?")+"v="+bust)});

  const pages=[...document.querySelectorAll(".page")]; let idx=0;
  const show=n=>{pages[idx].classList.remove("active"); idx=Math.max(0,Math.min(pages.length-1,n)); pages[idx].classList.add("active");};
  const n1=$("#n1"), n2=$("#n2"), n3=$("#n3");
  const v1=$("#vIntro"), v2=$("#vAscii"), v3=$("#vFinale");
  const overlay=$("#overlay"), again=$("#againBtn"), share=$("#shareBtn");

  // p1
  v1.play().catch(()=>{ v1.setAttribute("controls",""); });
  v1.addEventListener("ended", ()=>{ n1.classList.add("show"); });
  n1.addEventListener("click", ()=>{ show(1); v2.play().catch(()=>{ v2.setAttribute("controls",""); }); });

  // p2
  n2.addEventListener("click", ()=> show(2));

  // p3 → p4
  n3.addEventListener("click", ()=>{ show(3); v3.play().catch(()=>{ v3.setAttribute("controls",""); }); });

  // p4 overlay
  v3.addEventListener("ended", ()=>{ overlay.style.display="grid"; });
  again.addEventListener("click", ()=>{
    overlay.style.display="none"; show(0);
    n1.classList.remove("show");
    v1.currentTime=0; v1.play().catch(()=>{ v1.setAttribute("controls",""); });
  });
  share.addEventListener("click", async ()=>{
    try{ if(navigator.share){ await navigator.share({title:document.title,url:location.href}); }
      else{ await navigator.clipboard.writeText(location.href); toast("連結已複製！"); } }
    catch(e){ toast("分享取消或失敗"); }
  });

  // p2 ribbon fit
  const ribbon=$("#ribbon");
  function fitRibbon(){
    const box=ribbon.parentElement.getBoundingClientRect();
    ribbon.style.fontSize="18px";
    let fs=parseFloat(getComputedStyle(ribbon).fontSize);
    const min=10;
    while(ribbon.scrollWidth>box.width*0.95 && fs>min){ fs-=1; ribbon.style.fontSize=fs+"px"; }
    ribbon.style.whiteSpace="nowrap";
  }
  addEventListener("resize", fitRibbon); setTimeout(fitRibbon, 30);

  // p3 dynamic sizing to ensure full grid visible
  function layoutP3(){
    const p3=$("#p3"), banner=p3.querySelector(".banner"), hold=p3.querySelector(".gridHold"), grid=p3.querySelector(".grid4");
    const gap=parseFloat(getComputedStyle(grid).gap)||12;
    const reserved=90; // next btn & breathing
    const availH = p3.clientHeight - banner.offsetHeight - gap - reserved;
    const availW = hold.clientWidth;
    const tileW = Math.floor((availW - gap)/2);
    const tileHcap = Math.floor((availH - gap)/2);
    const tile = Math.max(120, Math.min(tileW, tileHcap));
    hold.style.height = (tile*2 + gap) + "px";
    grid.querySelectorAll(".badge").forEach(el=>el.style.height = tile+"px");
  }
  addEventListener("resize", layoutP3); setTimeout(layoutP3, 60);

  // ===== Modal helpers =====
  const modal=$("#modal"), mTitle=$("#mTitle"), mSub=$("#mSub"), mBg=$("#mBg"), mContent=$("#mContent"), mClose=$("#mClose");
  function openModal(bg, title, sub, builder){
    mBg.style.backgroundImage = "url('"+bg+"?v="+bust+"')";
    mTitle.textContent = title; mSub.textContent = sub;
    mContent.innerHTML = ""; // reset
    builder(mContent);
    modal.classList.add("show");
  }
  mClose.addEventListener("click", ()=> modal.classList.remove("show"));

  function toast(msg){ t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"), 1200); }
  const on=(el,fn)=>{ ["pointerup","click","keydown"].forEach(evt=>{ el.addEventListener(evt,(e)=>{ if(e.type==="keydown" && !["Enter"," "].includes(e.key)) return; e.preventDefault(); fn(e); }, {passive:false}); }); };
  const burst=(el,n=10)=>{const r=el.getBoundingClientRect();for(let i=0;i<n;i++){const s=document.createElement("div");s.className="spark";s.textContent=Math.random()>0.5?"✨":"⚡️";s.style.left=(r.left+r.width/2+(Math.random()*60-30))+"px";s.style.top=(r.top+r.height/2+(Math.random()*30-15))+"px";document.body.appendChild(s);setTimeout(()=>s.remove(),700);}};

  // Event delegation for grid clicks
  $("#grid4").addEventListener("click",(e)=>{
    const tile=e.target.closest(".badge"); if(!tile) return;
    const id=tile.id;
    if(id==="b1"){ // 能量瓶
      openModal("slot1.png","今天電量不足？充電站啟動 ⚡️","輕點一下，幫你回充精神與好心情。",(box)=>{
        const pbar=document.createElement("div"); pbar.className="pbar"; const fill=document.createElement("div"); fill.className="fill"; pbar.appendChild(fill);
        const full=document.createElement("div"); full.className="fullTag"; full.textContent="滿格！";
        box.append(pbar, full);
        let clicks=0, lock=false;
        on(box, ()=>{
          if(lock) return; lock=true;
          requestAnimationFrame(()=> fill.style.width="100%");
          setTimeout(()=>{ fill.style.width="0"; lock=false; }, 1100);
          clicks++; if(clicks%3===0){ full.style.display="inline-block"; burst(box,12); toast("已補滿，出發吧！"); setTimeout(()=>{ full.style.display="none"; }, 900); }
        });
      });
    }else if(id==="b2"){ // 天氣
      openModal("slot2.png","天氣系統連線中…今日晴朗指數提升，心情放晴！ 🌈","不論晴雨，願你處處順心。",(box)=>{
        const face=document.createElement("div"); face.className="face"; face.textContent="🌥️";
        const stamp=document.createElement("div"); stamp.className="stamp"; stamp.textContent="+1 順利";
        box.append(face, stamp);
        const S=["🌥️","☀️","🌈"]; let i=0;
        on(box, ()=>{ i=(i+1)%S.length; face.textContent=S[i]; stamp.style.opacity=1; stamp.style.transform="scale(1)"; setTimeout(()=>{ stamp.style.opacity=0; stamp.style.transform="scale(.9)"; }, 850); if(S[i]==="🌈") burst(box,12); });
      });
    }else if(id==="b3"){ // 花束
      openModal("slot3.png","送你一束今日的好運 💐","把好運綁成一束，突發狀況防護罩 ON 🍀。",(box)=>{
        const face=document.createElement("div"); face.className="face"; face.textContent="✨";
        const shield=document.createElement("div"); shield.className="shield"; shield.textContent="🍀 抵禦突發";
        box.append(face, shield);
        const V=[{e:"💪",l:"元氣"},{e:"🫶",l:"溫柔"},{e:"🌟",l:"閃亮"}]; let k=-1,c=0;
        on(box, ()=>{ c++; if(c%3===0){ k=(k+1)%V.length; face.textContent=V[k].e; shield.style.opacity=1; shield.style.transform="translateY(0)"; burst(box,10); toast("花束升級："+V[k].l); setTimeout(()=>{ shield.style.opacity=0; shield.style.transform="translateY(6px)"; }, 900); } });
      });
    }else if(id==="b4"){ // 禮物
      openModal("slot4.png","這份小禮物，裝著萬分感謝 ✨❤️","謝謝你，願好事不斷發生。",(box)=>{
        const g=document.createElement("div"); g.className="box"; g.innerHTML='<div class="lid"></div><div class="ribbonY"></div><div class="burst">✨💖✨</div><div class="note">博皓學長，謝謝你！</div>';
        box.append(g);
        let opened=false, noteOnce=false;
        on(box, ()=>{ if(!opened){ opened=true; g.classList.add("open"); burst(box,14); } else { opened=false; g.classList.remove("open"); if(!noteOnce){ noteOnce=true; const note=g.querySelector(".note"); note.style.opacity=1; note.style.top="-64px"; setTimeout(()=>{ note.style.opacity=0; note.style.top="-48px"; }, 600); } } });
      });
    }
  });

  // utility toast
  function toast(msg){ t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"), 1200); }
})();
</script>
</body></html>
