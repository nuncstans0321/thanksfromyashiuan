<!DOCTYPE html><html lang="zh-Hant"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>ÊÑüË¨ùÂç° ‚Äî v9.4.6</title>
<style>
:root{--r:22px;--card:#f2f3f5;--ink:#1f2328;--gap:12px}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",Arial,sans-serif;background:#0e0e10;color:var(--ink);display:flex;align-items:center;justify-content:center;overflow:hidden}
.stage{width:min(980px,96vw);height:min(780px,96svh)}@supports not (height:1svh){.stage{height:min(780px,96vh)}}
.card{position:relative;width:100%;height:100%;background:var(--card);border-radius:var(--r);overflow:hidden;box-shadow:0 28px 60px rgba(0,0,0,.25),0 8px 18px rgba(0,0,0,.12),inset 0 0 0 1px rgba(0,0,0,.08)}
.page{position:absolute;inset:0;padding:20px;display:grid;place-items:center;opacity:0;transform:translateY(8px);transition:.3s}
.page.active{opacity:1;transform:none}
#p1,#p2,#p4{padding:0}
#p3{display:block;overflow:auto;-webkit-overflow-scrolling:touch;padding:12px}
.vbox{position:relative;width:100%;height:100%;background:#000;border-radius:var(--r);overflow:hidden;display:flex;align-items:center;justify-content:center}
.vbox video{width:100%;height:100%;object-fit:contain;background:#000;display:block}
/* Next */
.next{position:fixed;right:calc(2vw + 8px);bottom:calc(2vh + 8px);padding:.7rem 1.05rem;border-radius:999px;border:1px solid #0002;background:#ffd24a;font-weight:800;z-index:60;display:none}
.next.show{display:inline-block}
/* P1 autoplay helper (shown only if autoplay fails) */
.tap2play{position:absolute;inset:0;display:none;place-items:center;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.35));color:#fff;z-index:5}
.tap2play .bubble{background:rgba(0,0,0,.45);border:1px solid #fff3;border-radius:14px;padding:10px 14px;font-weight:800}
/* p2 ribbon */
.p2ribbon{position:absolute;top:10px;left:50%;transform:translateX(-50%);background:#fff;border:1px solid #f2c94c;border-radius:12px;padding:6px 10px;font-weight:800;z-index:2;white-space:nowrap;max-width:95%;overflow:hidden;text-overflow:ellipsis;font-size:18px}
@media (max-width:480px){.p2ribbon{font-size:16px}}
/* p3 */
.gridArea{height:100%;display:grid;grid-template-rows:auto 1fr;gap:var(--gap)}
.banner{display:grid;grid-auto-rows:auto;justify-items:center;align-items:center;background:#fff7d9;border:1px solid #f2c94c;border-radius:12px;padding:10px 14px;font-weight:900;line-height:1.35}
.banner span{display:block}
.gridHold{position:relative}
.grid4{position:absolute;inset:0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr);gap:var(--gap);z-index:1}
.badge{background:#fff;border:1px solid #0001;border-radius:14px;padding:8px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.06);outline:0;touch-action:manipulation;display:grid;grid-template-rows:1fr;min-height:0}
.badge:focus{box-shadow:0 0 0 3px #3b82f6aa}
.thumb{width:100%;height:100%;border-radius:10px;overflow:hidden;background:#fff;display:grid;place-items:center}
.thumb img{width:100%;height:100%;object-fit:contain;display:block}
/* Bottom Sheet */
.sheet{position:fixed;left:0;right:0;bottom:0;transform:translateY(105%);transition:transform .28s ease;z-index:120;display:grid;justify-items:center}
.sheet.show{transform:translateY(0)}
.sheet .scrim{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);}
.sheet .panel{position:relative;width:min(720px,96vw);max-height:72svh;background:#fff;border-radius:18px 18px 0 0;box-shadow:0 -18px 48px rgba(0,0,0,.35);padding:16px 18px 18px 18px;display:grid;grid-template-rows:auto 1fr auto;gap:10px}
@media (min-width:720px){.sheet .panel{border-radius:18px;max-height:82svh;margin-bottom:4vh}}
.sheet h3{margin:0 0 6px 0;font-size:20px}
.sheet p{margin:0;color:#555}
.play{position:relative;background:#0f1220;border-radius:12px;display:grid;place-items:center;min-height:260px;overflow:hidden}
.play .bg{position:absolute;inset:0;background-size:cover;background-position:center;opacity:.28;filter:blur(2px)}
.play .content{position:relative;padding:16px;color:#fff;display:grid;gap:16px;justify-items:center}
.hint{font-size:12px;opacity:.88}
.sheet .actions{display:flex;justify-content:center}
.sheet .btn{border:1px solid #0002;background:#ffd24a;border-radius:999px;padding:.6rem 1.0rem;font-weight:800;cursor:pointer}
/* Widgets */
.pbar{width:min(520px,80%);height:12px;border:1px solid #2f3a5d;background:#0f1220;border-radius:999px;overflow:hidden}
.fill{width:0;height:100%;background:linear-gradient(90deg,#5146ff,#ffd54a);transition:width 1.1s}
.fullTag{display:none;margin-top:6px;background:#2a233f;color:#fff;font-size:12px;padding:4px 10px;border-radius:999px}
.face{font-size:60px}
.stamp{margin-top:6px;border:2px dashed #7ec3ff;color:#7ec3ff;font-weight:800;border-radius:8px;padding:4px 8px;opacity:0;transform:scale(.9);transition:.3s}
.shield{background:#24352a;color:#bff5cf;border:1px solid #3e6b4f;border-radius:10px;padding:6px 10px;opacity:0;transform:translateY(6px);transition:.3s}
/* Battery HUD (CSS fallback) */
.hud{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none}
.battery{display:grid;gap:6px;justify-items:center;filter:drop-shadow(0 6px 14px rgba(0,0,0,.45))}
.b-cell{width:210px;height:96px;border:5px solid #9bd2ff;border-radius:16px;position:relative;background:rgba(0,0,0,.3);overflow:hidden}
.b-cell:after{content:"";position:absolute;right:-18px;top:30px;width:18px;height:36px;background:#9bd2ff;border-radius:4px}
.b-fill{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,#1ee3ff,#7cffc9);box-shadow:inset 0 0 10px rgba(255,255,255,.35);transition:width .6s;border-right:4px solid rgba(255,255,255,.6)}
.b-label{font-weight:900;font-size:22px;color:#d7f6ff;text-shadow:0 2px 6px rgba(0,0,0,.35)}
/* Gift image */
.giftWrap{position:relative;display:grid;place-items:center}
.giftImg{width:min(380px,82%);max-width:82%;height:auto;border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.45)}
.giftGlow{animation:glow 1s ease-out}
@keyframes glow{0%{filter:brightness(1)}50%{filter:brightness(1.35)}100%{filter:brightness(1)}}
.giftNote{position:absolute;left:50%;top:-50px;transform:translateX(-50%);background:#fff;color:#333;padding:6px 10px;border-radius:8px;font-size:12px;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,.35);opacity:0;transition:.25s}
/* P4 */
#overlay{position:absolute;inset:0;display:none;place-items:center;background:radial-gradient(60% 60% at 50% 60%, rgba(0,0,0,.45), rgba(0,0,0,.18));backdrop-filter:blur(1.5px);z-index:70}
.finalWrap{display:grid;gap:16px;justify-items:center}
.finalWrap .jp{color:#fff;font-weight:900;font-size:clamp(24px,7.2vw,46px);text-shadow:0 3px 18px rgba(0,0,0,.5),0 1px 0 rgba(0,0,0,.25)}
.finalBtns{display:flex;gap:10px}
.finalBtns .btn{border:1px solid #0002;background:rgba(255,210,74,.95);border-radius:999px;padding:.6rem 1.0rem;font-weight:800;box-shadow:0 8px 20px rgba(0,0,0,.25)}
.finalBtns .ghost{background:rgba(255,255,255,.92)}
/* Toast / spark */
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#1e2433;border:1px solid #334063;color:#e8ebff;padding:8px 12px;border-radius:10px;opacity:0;transition:.25s;pointer-events:none;z-index:140}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
.spark{position:fixed;font-size:18px;animation:rise .65s ease-out forwards;pointer-events:none;z-index:135}
@keyframes rise{from{transform:translateY(0) scale(1);opacity:1}to{transform:translateY(-26px) scale(1.2);opacity:0}}
.only-mobile{display:none}@media (max-width:520px){.only-mobile{display:inline}}
</style>
</head><body>
<div class="stage"><div class="card">
  <!-- p1 -->
  <section class="page active" id="p1">
    <div class="vbox">
      <video id="vIntro" playsinline webkit-playsinline muted preload="auto" poster="poster.png"><source id="sIntro" src="envelope_open.mp4" type="video/mp4"></video>
      <div class="tap2play" id="tapP1"><div class="bubble">üîà ËºïÈªû‰∏Ä‰∏ãÈñãÂßãÊí≠Êîæ</div></div>
    </div>
    <button class="next" id="n1">‰∏ã‰∏ÄÈ†Å</button>
  </section>
  <!-- p2 -->
  <section class="page" id="p2">
    <div class="vbox">
      <div class="p2ribbon" id="ribbon">Áµ¶ÂçöÁöìÂ≠∏Èï∑ ÔΩû by 62 ÊúüÂ≠∏Âì°‰∫ûÁíá</div>
      <video id="vAscii" playsinline webkit-playsinline muted preload="auto" loop><source id="sAscii" src="ascii_anim.mp4" type="video/mp4"></video>
    </div>
    <button class="next show" id="n2">‰∏ã‰∏ÄÈ†Å</button>
  </section>
  <!-- p3 -->
  <section class="page" id="p3">
    <div class="gridArea">
      <div class="banner">
        <span>‰∫ûÁíáÁöÑÁ•ùÁ¶èÊ¥æÈÄÅ‰∏≠Ôºå</span>
        <span>‰ªªÈÅ∏‰∏Ä‰ªΩ‰ªäÊó• BuffÔºåÈªû‰∏Ä‰∏ãÈ†òÂèñ ‚ú®</span>
      </div>
      <div class="gridHold"><div class="grid4" id="grid4">
        <div class="badge" id="b1" role="button" tabindex="0"><div class="thumb"><img src="slot1.png" alt="ËÉΩÈáèÁì∂"></div></div>
        <div class="badge" id="b2" role="button" tabindex="0"><div class="thumb"><img src="slot2.png" alt="Â•ΩÂ§©Ê∞£"></div></div>
        <div class="badge" id="b3" role="button" tabindex="0"><div class="thumb"><img src="slot3.png" alt="Ëä±Êùü"></div></div>
        <div class="badge" id="b4" role="button" tabindex="0"><div class="thumb"><img src="slot4.png" alt="Á¶ÆÁâ©"></div></div>
      </div></div>
    </div>
    <button class="next show" id="n3">‰∏ã‰∏ÄÈ†Å</button>
  </section>
  <!-- p4 -->
  <section class="page" id="p4">
    <div class="vbox" id="finalBox"><video id="vFinale" playsinline webkit-playsinline muted preload="auto"><source id="sFinale" src="finale.mp4" type="video/mp4"></video>
      <div id="overlay">
        <div class="finalWrap">
          <div class="jp">„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô</div>
          <div class="finalBtns">
            <button class="btn" id="againBtn">ÂÜç‰∏ÄÊ¨°</button>
            <button class="btn ghost" id="shareBtn">ÂàÜ‰∫´</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div></div>

<!-- bottom sheet for p3 -->
<div class="sheet" id="sheet">
  <div class="scrim"></div>
  <div class="panel">
    <div>
      <h3 id="sTitle"></h3>
      <p id="sSub"></p>
    </div>
    <div class="play"><div class="bg" id="sBg"></div><div class="content" id="sContent"></div></div>
    <div class="actions"><button class="btn" id="sClose">‚ú® pikaÔΩû close</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
(function(){
  const $=s=>document.querySelector(s), t=$("#toast");
  const bust=Date.now().toString(36);
  ["#sIntro","#sAscii","#sFinale"].forEach(sel=>{const el=$(sel); if(el){el.src=el.getAttribute("src")+"?v="+bust;}});
  document.querySelectorAll("img").forEach(img=>{const src=img.getAttribute("src"); if(src) img.setAttribute("src", src+(src.includes("?")?"&":"?")+"v="+bust)});

  // Optional assets (non-blocking)
  const has = {B:false,F:false};
  function preload(src, key){ const im=new Image(); im.onload=()=>has[key]=true; im.src=src+"?v="+bust; }
  preload("B.png","B"); preload("flower2.png","F");

  const pages=[...document.querySelectorAll(".page")]; let idx=0;
  const show=n=>{pages[idx].classList.remove("active"); idx=Math.max(0,Math.min(pages.length-1,n)); pages[idx].classList.add("active");};
  const n1=$("#n1"), n2=$("#n2"), n3=$("#n3");
  const v1=$("#vIntro"), v2=$("#vAscii"), v3=$("#vFinale");
  const overlay=$("#overlay"), again=$("#againBtn"), share=$("#shareBtn");

  // ==== P1 (baseline behavior; only adds fallback overlay if autoplay fails) ====
  const tap=$("#tapP1");
  function startP1(){
    v1.play().then(()=>{ /* ok */ }).catch(()=>{
      v1.setAttribute("controls","");
      tap.style.display="grid";
    });
  }
  startP1();
  tap.addEventListener("click", ()=>{ tap.style.display="none"; v1.play().catch(()=>{}); });
  v1.addEventListener("ended", ()=>{ n1.classList.add("show"); });
  n1.addEventListener("click", ()=>{ show(1); v2.play().catch(()=>{ v2.setAttribute("controls",""); }); });

  // P2
  n2.addEventListener("click", ()=> show(2));

  // P3 ‚Üí P4
  n3.addEventListener("click", ()=>{ show(3); v3.play().catch(()=>{ v3.setAttribute("controls",""); }); });

  // P4 overlay
  v3.addEventListener("ended", ()=>{ overlay.style.display="grid"; });
  again.addEventListener("click", ()=>{
    overlay.style.display="none"; show(0);
    n1.classList.remove("show");
    v1.currentTime=0; startP1();
  });
  share.addEventListener("click", async ()=>{
    try{ if(navigator.share){ await navigator.share({title:document.title,url:location.href}); }
      else{ await navigator.clipboard.writeText(location.href); toast("ÈÄ£ÁµêÂ∑≤Ë§áË£ΩÔºÅ"); } }
    catch(e){ toast("ÂàÜ‰∫´ÂèñÊ∂àÊàñÂ§±Êïó"); }
  });

  // P2 ribbon fit (as-is)
  const ribbon=$("#ribbon");
  function fitRibbon(){
    const box=ribbon.parentElement.getBoundingClientRect();
    ribbon.style.fontSize="18px";
    let fs=parseFloat(getComputedStyle(ribbon).fontSize);
    const min=10;
    while(ribbon.scrollWidth>box.width*0.95 && fs>min){ fs-=1; ribbon.style.fontSize=fs+"px"; }
    ribbon.style.whiteSpace="nowrap";
  }
  addEventListener("resize", fitRibbon); setTimeout(fitRibbon, 30);

  // P3 layout (as-is)
  function layoutP3(){
    const p3=$("#p3"), banner=p3.querySelector(".banner"), hold=p3.querySelector(".gridHold"), grid=p3.querySelector(".grid4");
    const gap=parseFloat(getComputedStyle(grid).gap)||12;
    const reserved=90; // for next btn
    const availH = p3.clientHeight - banner.offsetHeight - gap - reserved;
    const availW = hold.clientWidth;
    const tileW = Math.floor((availW - gap)/2);
    const tileHcap = Math.floor((availH - gap)/2);
    const tile = Math.max(120, Math.min(tileW, tileHcap));
    hold.style.height = (tile*2 + gap) + "px";
    grid.querySelectorAll(".badge").forEach(el=>el.style.height = tile+"px");
  }
  addEventListener("resize", layoutP3); setTimeout(layoutP3, 60);

  // ===== Bottom sheet helpers (as v9.4.4 base) =====
  const sheet=$("#sheet"), sBg=$("#sBg"), sTitle=$("#sTitle"), sSub=$("#sSub"), sContent=$("#sContent"), sClose=$("#sClose");
  function openSheet(opts){
    const {bg, title, sub, builder, titleHTML} = opts;
    sBg.style.backgroundImage="url('"+bg+"?v="+bust+"')";
    if(titleHTML){ sTitle.innerHTML = titleHTML; } else { sTitle.textContent = title; }
    sSub.textContent=sub;
    sContent.innerHTML=""; builder(sContent, sBg);
    sheet.classList.add("show");
  }
  function closeSheet(){ sheet.classList.remove("show"); }
  sClose.addEventListener("click", closeSheet);
  sheet.querySelector(".scrim").addEventListener("click", closeSheet);

  // helpers
  function toast(msg){ t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"), 1200); }
  const on=(el,fn)=>{ ["pointerup","click","touchend","keydown"].forEach(evt=>{ el.addEventListener(evt,(e)=>{ if(e.type==="keydown" && !["Enter"," "].includes(e.key)) return; e.preventDefault(); e.stopPropagation(); fn(e); }, {passive:false}); }); };
  const burst=(el,n=10)=>{const r=el.getBoundingClientRect();for(let i=0;i<n;i++){const s=document.createElement("div");s.className="spark";s.textContent=Math.random()>0.5?"‚ú®":"‚ö°Ô∏è";s.style.left=(r.left+r.width/2+(Math.random()*60-30))+"px";s.style.top=(r.top+r.height/2+(Math.random()*30-15))+"px";document.body.appendChild(s);setTimeout(()=>s.remove(),700);}};

  // bind helper
  function bindTile(id, cb){
    const tile=document.getElementById(id);
    if(!tile) return;
    ["click","pointerup","touchend"].forEach(evt=>tile.addEventListener(evt,(e)=>{e.preventDefault(); e.stopPropagation(); cb();},{passive:false}));
    const img=tile.querySelector("img");
    if(img) ["click","pointerup","touchend"].forEach(evt=>img.addEventListener(evt,(e)=>{e.preventDefault(); e.stopPropagation(); cb();},{passive:false}));
  }

  // ===== A ËÉΩÈáèÁì∂Ôºà3Ê≠•ÔºöÊ¢ù‚Üí80%‚Üí100%Ôºâ =====
  bindTile("b1", ()=>openSheet({
    bg:"slot1.png",
    title:"‰ªäÂ§©ÈõªÈáè‰∏çË∂≥ÔºüÂÖÖÈõªÁ´ôÂïüÂãï ‚ö°Ô∏è",
    sub:"ËºïÈªû‰∏Ä‰∏ãÔºåÂπ´‰Ω†ÂõûÂÖÖÁ≤æÁ•ûËàáÂ•ΩÂøÉÊÉÖ„ÄÇ",
    builder:(box, bgEl)=>{
      const tip=document.createElement("div"); tip.className="hint"; tip.textContent="ËºïÈªûÁï´Èù¢ÂÖÖÈõª ‚Üí";
      const pbar=document.createElement("div"); pbar.className="pbar"; const fill=document.createElement("div"); fill.className="fill"; pbar.appendChild(fill);
      const hud=document.createElement("div"); hud.className="hud"; hud.style.display="none";
      box.append(tip, pbar, hud);
      let step=0, lock=false;
      function showBattery(percent){
        hud.style.display="grid"; hud.innerHTML="";
        if(has.B){
          const im=document.createElement("img"); im.src="B.png?v="+bust; im.alt="battery"; im.style.width="240px"; im.style.filter="drop-shadow(0 8px 20px rgba(0,0,0,.45))";
          const lab=document.createElement("div"); lab.className="b-label"; lab.textContent=(percent===100?"‚ö°Ô∏è 100%":"‚ö°Ô∏è "+percent+"%");
          const wrap=document.createElement("div"); wrap.style.display="grid"; wrap.style.justifyItems="center"; wrap.append(im, lab);
          hud.append(wrap);
        }else{
          const wrap=document.createElement("div"); wrap.className="battery";
          const cell=document.createElement("div"); cell.className="b-cell";
          const lvl=document.createElement("div"); lvl.className="b-fill"; lvl.style.width=percent+"%";
          cell.appendChild(lvl);
          const lab=document.createElement("div"); lab.className="b-label"; lab.textContent=(percent===100?"‚ö°Ô∏è 100%":"‚ö°Ô∏è "+percent+"%");
          wrap.append(cell, lab);
          hud.append(wrap);
        }
        bgEl.classList.remove("shine"); void bgEl.offsetWidth; bgEl.classList.add("shine");
        setTimeout(()=>{ hud.style.display="none"; }, 1000);
      }
      on(box, ()=>{
        if(lock) return; lock=true;
        step = (step%3)+1;
        if(step===1){
          requestAnimationFrame(()=> fill.style.width="100%");
          tip.textContent="ÂÜçÈªûÂÖ©‰∏ãÊúÉËß∏Áôº„ÄéÊªøÊ†º„ÄèÂ∞èÂΩ©Ëõã ‚ú®";
          setTimeout(()=>{ fill.style.width="0"; lock=false; }, 1100);
        }else if(step===2){
          showBattery(80);
          tip.textContent="ÊúÄÂæå‰∏Ä‰∏ãÔºÅ";
          setTimeout(()=>{ lock=false; }, 650);
        }else{
          showBattery(100);
          burst(box,14);
          tip.textContent="ÊªøÊ†ºÔºÅÂèØ‰ª•ÂÜçÁé©‰∏ÄÊ¨°ÔºåÊàñÊèõÂÖ∂‰ªñ Buff„ÄÇ";
          setTimeout(()=>{ lock=false; }, 650);
        }
      });
    }
  }));

  // ===== B Â•ΩÂ§©Ê∞£ÔºàÈô∞‚ÜíÊó•‚ÜíËôπÔºâ =====
  bindTile("b2", ()=>openSheet({
    bg:"slot2.png",
    titleHTML:'Â§©Ê∞£Á≥ªÁµ±ÈÄ£Á∑ö‰∏≠‚Ä¶<span class="only-mobile"><br></span>‰ªäÊó•Êô¥ÊúóÊåáÊï∏ÊèêÂçáÔºåÂøÉÊÉÖÊîæÊô¥ÔºÅ üåà',
    sub:"‰∏çË´ñÊô¥Èõ®ÔºåÈ°ò‰Ω†ËôïËôïÈ†ÜÂøÉ„ÄÇ",
    builder:(box)=>{
      const tip=document.createElement("div"); tip.className="hint"; tip.textContent="ËºïÈªûÔºöÁÉèÈõ≤Êï£Èñã ‚Üí";
      const face=document.createElement("div"); face.className="face"; face.textContent="üå•Ô∏è";
      const stamp=document.createElement("div"); stamp.className="stamp"; stamp.textContent="+1 È†ÜÂà©";
      box.append(tip, face, stamp);
      let s=0;
      on(box, ()=>{
        s=(s%3)+1;
        if(s===1){ face.textContent="‚õÖ"; tip.textContent="ÂÜçÈªûÔºöÂá∫Â§™ÈôΩ"; }
        else if(s===2){ face.textContent="‚òÄÔ∏è"; tip.textContent="ÂÜçÈªûÔºöÂá∫ÂΩ©ËôπÔºàÂÆåÊàêÔºâ"; }
        else{ face.textContent="üåà"; tip.textContent="ÊîæÊô¥ÂÆåÊàêÔºÅÂèØ‰ª•ÂÜçÁé©‰∏ÄÊ¨°ÔºåÊàñÊèõÂÖ∂‰ªñ Buff„ÄÇ"; stamp.style.opacity=1; stamp.style.transform="scale(1)"; setTimeout(()=>{ stamp.style.opacity=0; stamp.style.transform="scale(.9)"; }, 900); burst(box,12); s=0; }
      });
    }
  }));

  // ===== C Ëä±ÊùüÔºàÂÖÉÊ∞£‚ÜíÊ∫´Êüî‚ÜíÈñÉ‰∫Æ + ÂèØÈÅ∏ÁôºÂÖâËä±ÊùüÔºâ =====
  bindTile("b3", ()=>openSheet({
    bg:"slot3.png",
    title:"ÈÄÅ‰Ω†‰∏ÄÊùü‰ªäÊó•ÁöÑÂ•ΩÈÅã üíê",
    sub:"ÊääÂ•ΩÈÅãÁ∂ÅÊàê‰∏ÄÊùüÔºåÁ™ÅÁôºÁãÄÊ≥ÅÈò≤Ë≠∑ÁΩ© ON üçÄ„ÄÇ",
    builder:(box, bgEl)=>{
      const tip=document.createElement("div"); tip.className="hint"; tip.textContent="Á¨¨ 1 ‰∏ãÔºöÂÖÉÊ∞£Ôºà‰∫ÆÂΩ©Ôºâ ‚Üí";
      const face=document.createElement("div"); face.className="face"; face.textContent="üí™";
      const shield=document.createElement("div"); shield.className="shield"; shield.textContent="üçÄ ÊäµÁ¶¶Á™ÅÁôº";
      box.append(tip, face, shield);
      let step=0;
      on(box, ()=>{
        step=(step%3)+1;
        if(step===1){ face.textContent="üí™"; tip.textContent="‰∏ã‰∏ÄÁ®ÆÔºöÊ∫´Êüî"; burst(box,8); }
        else if(step===2){ face.textContent="ü´∂"; tip.textContent="‰∏ã‰∏ÄÁ®ÆÔºöÈñÉ‰∫Æ"; burst(box,8); }
        else{ face.textContent="üåü"; if(has.F){ bgEl.style.backgroundImage="url('flower2.png?v="+bust+"')"; } shield.style.opacity=1; shield.style.transform="translateY(0)"; burst(box,10); setTimeout(()=>{ shield.style.opacity=0; shield.style.transform="translateY(6px)"; if(has.F){ bgEl.style.backgroundImage="url('slot3.png?v="+bust+"')"; } }, 1000); tip.textContent="ÂÆåÊàêÔºÅÂèØ‰ª•ÂÜçÁé©‰∏ÄÊ¨°ÔºåÊàñÊèõÂÖ∂‰ªñ Buff„ÄÇ"; step=0; }
      });
    }
  }));

  // ===== D Á¶ÆÁâ©Ôºàglow ‚Üí noteÔºâ =====
  bindTile("b4", ()=>openSheet({
    bg:"slot4.png",
    title:"ÈÄô‰ªΩÂ∞èÁ¶ÆÁâ©ÔºåË£ùËëóËê¨ÂàÜÊÑüË¨ù ‚ú®‚ù§Ô∏è",
    sub:"Ë¨ùË¨ù‰Ω†ÔºåÈ°òÂ•Ω‰∫ã‰∏çÊñ∑ÁôºÁîü„ÄÇ",
    builder:(box)=>{
      const tip=document.createElement("div"); tip.className="hint"; tip.textContent="Èªû‰∏Ä‰∏ãÈñãÁõíÔºåÂÜçÈªûÁúãÂ∞èÁ¥ôÊ¢ù ‚Üí";
      const wrap=document.createElement("div"); wrap.className="giftWrap";
      const img=document.createElement("img"); img.className="giftImg"; img.src="slot4.png?v="+bust; img.alt="Á¶ÆÁâ©";
      const note=document.createElement("div"); note.className="giftNote"; note.textContent="ÂçöÁöìÂ≠∏Èï∑ÔºåË¨ùË¨ù‰Ω†ÔºÅ";
      wrap.append(img,note);
      box.append(tip, wrap);
      let step=0, noted=false;
      on(box, ()=>{
        step=(step%2)+1;
        if(step===1){ img.classList.remove("giftGlow"); void img.offsetWidth; img.classList.add("giftGlow"); burst(wrap,12); tip.textContent="ÂÜçÈªû‰∏ÄÊ¨°ÔºöÈ°ØÁ§∫ÊÑüË¨ùÂ∞èÁ¥ôÊ¢ù"; }
        else{ if(!noted){ noted=true; note.style.opacity=1; note.style.top="-64px"; setTimeout(()=>{ note.style.opacity=0; note.style.top="-50px"; }, 700); tip.textContent="ÂÆåÊàêÔºÅÂèØ‰ª•ÈóúÈñâÊàñÊèõÂÖ∂‰ªñ BuffÔºõÂÜçÈªûÈáç‰æÜ„ÄÇ"; } else { noted=false; } }
      });
    }
  }));

  // first paint layout
  setTimeout(layoutP3, 0);
})();
</script>
</body></html>
