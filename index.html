<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>感謝卡 — v9.1 修正</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@700&family=Noto+Serif+JP:wght@600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
:root{
  --scene:#0e0e10; --scene-soft:#17181c; --paper:#fffef9; --ink:#222;
  --gold1:#ffe79b; --gold2:#ffcf4d; --goldText:#3b2a00; --radius:22px;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0; font-family: ui-rounded, "Noto Sans TC", system-ui, -apple-system, Segoe UI, Arial; color: var(--ink);
  background: radial-gradient(1200px 800px at 20% 20%, color-mix(in lab, var(--scene-soft) 25%, white), var(--scene));
  display:flex; align-items:center; justify-content:center; overflow:hidden;
}
.stage{ width:min(980px,96vw); height:min(700px,94svh); position:relative; }
@supports not (height: 1svh){ .stage{height:min(700px,94vh);} }

.card{
  position:absolute; inset:0; background: color-mix(in lab, var(--scene) 6%, white); border-radius: var(--radius);
  box-shadow: 0 28px 60px rgba(0,0,0,.25), 0 8px 18px rgba(0,0,0,.12), inset 0 0 0 1px color-mix(in lab, var(--scene) 20%, white);
  overflow:hidden; display:grid; grid-template-rows: 1fr;
}
.pages{position:relative; overflow:hidden}
.page{
  position:absolute; inset:0; opacity:0; transform: translateY(10px) scale(.985);
  transition: .45s ease; padding: clamp(12px, 3vw, 28px); display:grid; place-items:center;
}
.page.active{opacity:1; transform:none}

/* 影片容器 */
.vbox{
  position:relative; width:100%; height:100%; border-radius:16px; overflow:hidden;
  display:flex; align-items:center; justify-content:center; background:var(--scene);
  box-shadow: inset 0 0 0 1px color-mix(in lab, var(--scene) 40%, white);
}
/* p1 強制黑底、去邊線；影片等比置中，避免白邊 */
#p1 .vbox{ background:#000; box-shadow:none; }
.vbox video{ width:100%; height:100%; object-fit:contain; background:#000; display:block; }

/* 播放／膠囊按鈕 */
.playBtn, .pillBtn{
  --pill-bg: linear-gradient(to bottom right, color-mix(in lab, #fff6 40%, var(--gold1)), color-mix(in lab, #0000 0%, var(--gold2)));
  --pill-border: color-mix(in lab, var(--scene) 30%, white);
}
.playBtn{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:10;
  border:1px solid var(--pill-border); border-radius:999px; background: var(--pill-bg); color: var(--goldText);
  padding:16px 22px; font-weight:900; font-size:18px; box-shadow:0 12px 28px rgba(0,0,0,.28), inset 0 0 0 1px #fff3;
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); cursor:pointer; display:none;
}
.playBtn.show{ display:block }
.playBtn .tri{ display:inline-block; width:0; height:0; border-left:12px solid var(--goldText); border-top:8px solid transparent; border-bottom:8px solid transparent; margin-right:8px; }

@keyframes softGlow{ 0%,100%{ box-shadow:0 0 0 rgba(255,207,77,0); } 50%{ box-shadow:0 0 22px rgba(255,207,77,.45); } }
.pillBtn{ display:inline-flex; align-items:center; gap:.55rem; background: var(--pill-bg); color: var(--goldText);
  border:1px solid var(--pill-border); border-radius:999px; padding:.85rem 1.15rem; font-weight:900; cursor:pointer; animation: softGlow 2.3s infinite ease-in-out;
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
.pillBtn.dark{ background: linear-gradient(to bottom right, color-mix(in lab, #fff6 10%, var(--scene)), color-mix(in lab, #0000 0%, var(--scene)) );
  color:#fff; border-color: color-mix(in lab, var(--scene) 15%, white); animation:none }
.pillBtn .ico{ filter: drop-shadow(0 2px 2px rgba(0,0,0,.25)); }
.nextFab{ position:absolute; right:18px; bottom:18px; z-index:20; display:none }
.nextFab.show{ display:inline-flex }

/* p2 ASCII：水平橫幅置頂，不遮畫面 */
.p2wrap{ position:relative; width:100%; height:100%; border-radius:16px; display:flex; align-items:center; justify-content:center; background:#fff;
  box-shadow: inset 0 0 0 1px color-mix(in lab, var(--scene) 40%, white); }
.p2wrap video{ max-width:100%; max-height:100%; width:auto; height:auto; display:block }
.ribbon{
  position:absolute; top:8px; left:50%; transform:translateX(-50%); white-space:nowrap; padding:6px 10px; border-radius:12px;
  font-weight:800; letter-spacing:.02em; z-index:5; color:#111; background: rgba(255,255,255,.85); border:1px solid rgba(245,211,108,.55); text-shadow:none;
}

/* p3 四格區 */
.gridArea{ width:100%; height:100%; display:flex; flex-direction:column; gap:10px }
.banner{
  position:relative; text-align:center; font-weight:900; padding:10px 12px; border-radius:14px;
  background:linear-gradient(135deg, rgba(245,211,108,.16), rgba(255,255,255,.04)); border:1px solid rgba(245,211,108,.35);
  box-shadow:0 8px 24px rgba(245,211,108,.12), inset 0 0 40px rgba(245,211,108,.05); font-size: clamp(14px, 2.4vw, 18px);
}
.grid4{ display:grid; grid-template-columns:repeat(2, minmax(160px, 1fr)); gap:14px; width:100%; flex:1 }
@media (max-width:480px){ .grid4{ grid-template-columns:1fr; } }

.badge{
  display:flex; flex-direction:column; align-items:stretch; border:1px solid color-mix(in lab, var(--scene) 25%, white); border-radius:16px;
  background: color-mix(in lab, var(--scene) 8%, white); text-decoration:none; color:inherit; min-height:180px; cursor:pointer;
  box-shadow: 0 6px 18px rgba(0,0,0,.08); transition: transform .12s ease, box-shadow .2s ease; position:relative; z-index:1; touch-action:manipulation;
  padding:10px 10px 12px;
}
.badge:hover{ transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.12) }
/* 先顯示原圖，不遮罩 */
.badge img{ order:-1; position:static; width:100%; height:auto; object-fit:cover; opacity:1; filter:none; margin-bottom:8px; border-radius:12px; }
/* 文字斷行友善 */
.badge h4{ margin:0 0 6px 0; font-size:16px; line-height:1.35; text-wrap:balance; word-break:keep-all }
.badge p{ margin:0 0 8px 0; font-size:13px; opacity:.78; line-height:1.5; word-break:keep-all }
.badge .mark{ position:absolute; top:8px; right:8px; font-size:12px; font-weight:800; padding:4px 8px; border-radius:999px;
  border:1px dashed color-mix(in lab, var(--scene) 35%, white); opacity:.85; backdrop-filter: blur(2px) }
.badge .floating{ position:absolute; inset:0; pointer-events:none }

/* 效果：預設隱藏，點擊才出現 */
.pbar{ display:none; position:relative; height:10px; border-radius:999px; overflow:hidden; border:1px solid #2f3a5d; background:#0f1220; margin-top:4px }
.pbar .fill{ height:100%; width:0%; background:linear-gradient(90deg, #5146ff, #ffd54a); box-shadow:0 0 18px rgba(255,213,74,.5) inset; transition:width 1.1s ease }
.fullTag{ display:none; position:absolute; top:8px; left:8px; padding:4px 8px; border-radius:999px; background:#2a233f; border:1px solid #5a4bb3; color:#fff; font-size:12px; }
.stamp{ position:absolute; bottom:10px; right:10px; padding:6px 10px; border:2px dashed #7ec3ff; border-radius:8px; color:#7ec3ff; font-weight:800; opacity:0; transform:scale(.9); transition:.35s ease }
.face{ font-size:42px; margin-top:2px }
.shield{ position:absolute; right:10px; bottom:10px; background:#24352a; border:1px solid #3e6b4f; color:#bff5cf; padding:6px 10px; border-radius:10px; opacity:0; transform:translateY(6px); transition:.35s ease }
.box{ width:120px; height:78px; background:linear-gradient(180deg,#7a1f19,#6a1712); border:2px solid #a93b2f; border-radius:10px; position:relative; margin-top:8px }
.lid{ position:absolute; width:130px; height:22px; background:linear-gradient(180deg,#c44a3c,#a83e33); border:2px solid #a93b2f; border-bottom:none; border-radius:12px 12px 6px 6px; top:-20px; left:-5px; transform-origin:left center; transition:.35s ease }
.ribbonY{ position:absolute; width:12px; height:100%; left:50%; top:0; transform:translateX(-50%); background:linear-gradient(180deg,#ffd54a,#f9b84a) }
.burst{ position:absolute; left:50%; top:-30px; transform:translateX(-50%); font-size:28px; opacity:0; transition:.35s ease }
.note{ position:absolute; left:50%; top:-50px; transform:translateX(-50%); background:#fff; color:#333; padding:6px 10px; border-radius:8px; font-size:12px; font-weight:700; box-shadow:0 6px 18px rgba(0,0,0,.35); opacity:0; transition:.25s ease }
.open .lid{ transform:rotate(-22deg) translateY(-6px) }
.open .burst{ opacity:1; transform:translateX(-50%) translateY(-6px) }

/* Finale */
.final-msg{ position:absolute; inset:0; display:none; place-items:center; background:linear-gradient(to bottom, rgba(0,0,0,.35), rgba(0,0,0,.15)) }
.final-msg .inner{ text-align:center; padding:14px 18px; border-radius:16px; background: linear-gradient( to bottom, rgba(0,0,0,.35), rgba(0,0,0,.15) ); box-shadow: 0 18px 44px rgba(0,0,0,.35); }
.final-msg .jp{
  font-family: "Zen Maru Gothic","Noto Serif JP", system-ui, -apple-system, "Hiragino Sans", "Yu Gothic", "Microsoft JhengHei", sans-serif;
  color:#fff; font-weight:800; letter-spacing:.04em; white-space:nowrap; font-size: clamp(24px, 8.2vw, 56px);
  text-shadow: 0 2px 12px rgba(0,0,0,.75), 0 0 2px rgba(0,0,0,.9), 0 0 14px rgba(0,0,0,.8);
}
.final-msg .btns{ margin-top:16px; display:flex; gap:10px; justify-content:center }
.final-msg .btns .pillBtn{ animation:none }

/* CSS 後備彈窗與小彩蛋／Toast */
.layer{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); z-index:999999 }
.layer:target{ display:grid }
.layer .panel{ background:#fff; color:#222; padding:24px; border-radius:18px; width:min(92vw,720px);
  text-align:center; font-size:clamp(18px,4vw,24px); line-height:1.6; border:2px solid var(--gold2); box-shadow:0 22px 60px rgba(0,0,0,.35) }
.layer .panel a{ display:inline-block; margin-top:16px }
.spark{ position:absolute; font-size:18px; pointer-events:none; animation: rise .65s ease-out forwards }
@keyframes rise{ from{ transform: translateY(0) scale(1); opacity:1 } to{ transform: translateY(-26px) scale(1.2); opacity:0 } }
.toast{ position:fixed; left:50%; bottom:26px; transform:translateX(-50%); background:#1e2433; border:1px solid #334063; color:#e8ebff;
  padding:8px 12px; border-radius:10px; opacity:0; pointer-events:none; transition:opacity .25s ease, transform .25s ease; z-index:1000; }
.toast.show{opacity:1; transform:translateX(-50%) translateY(-6px)}
</style>
</head>
<body>
<div class="stage">
  <div class="card">
    <div class="pages">

      <!-- p1 -->
      <section class="page active" id="p1">
        <div class="vbox" id="boxIntro">
          <video id="vIntro" playsinline webkit-playsinline muted preload="auto" poster="poster.png">
            <source id="sIntro" src="envelope_open.mp4" type="video/mp4">
          </video>
          <button class="playBtn" id="p1Play"><span class="tri"></span>播放</button>
        </div>
        <button class="pillBtn nextFab" id="nextFab"><span class="ico">⚡️</span><span>下一頁</span></button>
      </section>

      <!-- p2 -->
      <section class="page" id="p2">
        <div class="p2wrap" id="p2wrap">
          <div class="ribbon">給博皓學長 ～ by 62期學員亞璇</div>
          <video id="vAscii" playsinline webkit-playsinline muted preload="auto" loop>
            <source id="sAscii" src="ascii_anim.mp4" type="video/mp4">
          </video>
        </div>
        <button class="pillBtn nextFab" id="nextFab2"><span class="ico">⚡️</span><span>下一頁</span></button>
      </section>

      <!-- p3 -->
      <section class="page" id="p3">
        <div class="gridArea">
          <div class="banner">亞璇的祝福派送中，任選一份今日 Buff，點一下領取 ✨</div>
          <div class="grid4" id="grid4">
            <!-- A 能量瓶 -->
            <a class="badge" id="badge1" href="#m1" data-msg="工作辛苦了，加油 💪✨" onclick="return false" tabindex="0">
              <span class="mark">電黃 ⚡️</span>
              <h4>今天電量不足？充電站啟動 ⚡️</h4>
              <p>輕點一下，幫你回充精神與好心情。</p>
              <img id="slot1" alt="能量瓶">
              <div class="fullTag" id="energyFull">滿格！</div>
              <div class="pbar" aria-hidden="true"><div class="fill" id="energyFill"></div></div>
              <div class="floating" id="pf1"></div>
            </a>
            <!-- B 天氣 -->
            <a class="badge" id="badge2" href="#m2" data-msg="工作一切順利～ 🌈" onclick="return false" tabindex="0">
              <span class="mark">天藍 ☀️</span>
              <h4>天氣系統連線中…今日晴朗指數提升，心情放晴！ 🌈</h4>
              <p>不論晴雨，願你處處順心。</p>
              <img id="slot2" alt="好天氣">
              <div class="face" id="weatherFace">🌥️</div>
              <div class="stamp" id="weatherStamp">+1 順利</div>
              <div class="floating" id="pf2"></div>
            </a>
            <!-- C 花束 -->
            <a class="badge" id="badge3" href="#m3" data-msg="希望今天沒有突發狀況，是順心好日子！🍀" onclick="return false" tabindex="0">
              <span class="mark">粉紅＋綠 💐</span>
              <h4>送你一束今日的好運 💐</h4>
              <p>把好運綁成一束，突發狀況防護罩 ON 🍀。</p>
              <img id="slot3" alt="花束">
              <div class="face" id="bouquetFace">✨</div>
              <div class="shield" id="bouquetShield">🍀 抵禦突發</div>
              <div class="floating" id="pf3"></div>
            </a>
            <!-- D 禮物 -->
            <a class="badge" id="badge4" href="#m4" data-msg="呈上真心的萬分感謝 ✨⭐️❤️" onclick="return false" tabindex="0">
              <span class="mark">金＋暖紅 🎁</span>
              <h4>這份小禮物，裝著萬分感謝 ✨❤️</h4>
              <p>謝謝你，願好事不斷發生。</p>
              <img id="slot4" alt="禮物">
              <div class="box" id="giftBox">
                <div class="lid"></div>
                <div class="ribbonY"></div>
                <div class="burst">✨💖✨</div>
                <div class="note" id="giftNote">博皓學長，謝謝你！</div>
              </div>
              <div class="floating" id="pf4"></div>
            </a>
          </div>
        </div>
        <button class="pillBtn nextFab" id="nextFab3"><span class="ico">⚡️</span><span>下一頁</span></button>
      </section>

      <!-- p4 -->
      <section class="page" id="p4">
        <div class="vbox" id="boxFinal">
          <video id="vFinale" playsinline webkit-playsinline muted preload="auto">
            <source id="sFinale" src="finale.mp4" type="video/mp4">
          </video>
          <div class="final-msg" id="finalMsg">
            <div class="inner">
              <div class="jp">ありがとうございます</div>
              <div class="btns">
                <button class="pillBtn" id="btnReplay"><span class="ico">🔁</span><span>再一次</span></button>
                <button class="pillBtn dark" id="btnShare"><span class="ico">🔗</span><span>分享</span></button>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>
</div>

<!-- CSS :target fallbacks -->
<section id="m1" class="layer"><div class="panel">工作辛苦了，加油 💪✨<br><a class="pillBtn" href="#p3"><span class="ico">✨</span><span>pika~</span></a></div></section>
<section id="m2" class="layer"><div class="panel">工作一切順利～ 🌈<br><a class="pillBtn" href="#p3"><span class="ico">✨</span><span>pika~</span></a></div></section>
<section id="m3" class="layer"><div class="panel">希望今天沒有突發狀況，是順心好日子！🍀<br><a class="pillBtn" href="#p3"><span class="ico">✨</span><span>pika~</span></a></div></section>
<section id="m4" class="layer"><div class="panel">呈上真心的萬分感謝 ✨⭐️❤️<br><a class="pillBtn" href="#p3"><span class="ico">✨</span><span>pika~</span></a></div></section>

<div class="layer" id="dyn" style="display:none"><div class="panel"><div id="dynText"></div><a class="pillBtn" href="#p3" onclick="dyn.style.display='none'"><span class="ico">✨</span><span>pika~</span></a></div></div>
<div class="toast" id="toast"></div>

<script>
(function(){
  const toast = (msg, ms=1200) => { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); clearTimeout(t._h); t._h = setTimeout(()=>t.classList.remove('show'), ms); };
  const makeBurst = (holder, n=10) => {
    const rect = holder.getBoundingClientRect();
    for(let i=0;i<n;i++){
      const s=document.createElement('div'); s.className='spark'; s.textContent = Math.random()>0.5?'✨':'⚡️';
      s.style.left = (rect.left + rect.width/2 + (Math.random()*60-30)) + 'px';
      s.style.top  = (rect.top  + rect.height/2 + (Math.random()*30-15)) + 'px';
      s.style.position='fixed'; document.body.appendChild(s); setTimeout(()=>s.remove(), 700);
    }
  };

  const VER = Date.now().toString(36);
  const bust = (u)=> u + (u.includes('?') ? '&' : '?') + 'v=' + VER;
  ['sIntro','sAscii','sFinale'].forEach(id=>{ const s=document.getElementById(id); if(s) s.src = bust(s.getAttribute('src')); });

  const pages=[...document.querySelectorAll('.page')]; let idx=0;
  function show(i){
    pages[idx].classList.remove('active'); idx=Math.max(0,Math.min(pages.length-1,i)); pages[idx].classList.add('active');
    nextFab.classList.toggle('show', idx===0 && introEnded); nextFab2.classList.toggle('show', idx===1); nextFab3.classList.toggle('show', idx===2);
    if(idx===1){ ensurePlay(vAscii); } if(idx===3){ ensurePlay(vFinale); }
  }

  const nextFab=document.getElementById('nextFab');
  const nextFab2=document.getElementById('nextFab2');
  const nextFab3=document.getElementById('nextFab3');
  nextFab.onclick=()=>show(1); nextFab2.onclick=()=>show(2); nextFab3.onclick=()=>show(3);

  const vIntro=document.getElementById('vIntro');
  const vAscii=document.getElementById('vAscii');
  const vFinale=document.getElementById('vFinale');

  const p1Play=document.getElementById('p1Play');
  function tryAutoStart(){ vIntro.play().then(()=> p1Play.classList.remove('show')).catch(()=> p1Play.classList.add('show')); }
  document.addEventListener('DOMContentLoaded', tryAutoStart, {once:true});
  p1Play.addEventListener('click', ()=> vIntro.play().then(()=> p1Play.classList.remove('show')) );
  vIntro.addEventListener('click', ()=> { if(vIntro.paused) vIntro.play().then(()=> p1Play.classList.remove('show')); });

  let introEnded=false;
  vIntro.addEventListener('ended', ()=>{ introEnded=true; nextFab.classList.add('show'); });

  const finalMsg=document.getElementById('finalMsg');
  vFinale.addEventListener('ended', ()=>{ finalMsg.style.display='grid'; });
  document.getElementById('btnReplay')?.addEventListener('click', ()=>{
    finalMsg.style.display='none'; [vFinale,vAscii,vIntro].forEach(v=>{ try{v.pause(); v.currentTime=0;}catch(e){} });
    introEnded=false; show(0); tryAutoStart();
  });

  document.getElementById('btnShare')?.addEventListener('click', ()=>{
    const layer=document.createElement('div');
    layer.className='layer'; layer.style.display='grid';
    layer.innerHTML=`<div class="panel"><h3 style="margin:0 0 6px 0;">分享這張卡片</h3>
      <div id="qr" style="display:grid;place-items:center;margin:10px auto"></div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
        <button class="pillBtn dark" id="copyUrl"><span class="ico">📋</span><span>複製網址</span></button>
        <button class="pillBtn" id="closeShare"><span class="ico">✖</span><span>關閉</span></button>
      </div>
      <div id="copyNote" style="font-size:13px;color:#666;margin-top:6px;text-align:center"></div>`;
    document.body.appendChild(layer);
    layer.addEventListener('click',(e)=>{ if(e.target===layer){ layer.remove(); } });
    layer.querySelector('#closeShare').onclick = ()=> layer.remove();
    layer.querySelector('#copyUrl').onclick = async ()=>{
      const url=location.href.split('#')[0];
      try{ await navigator.clipboard.writeText(url); layer.querySelector('#copyNote').textContent='已複製網址 ✔'; }
      catch(e){ layer.querySelector('#copyNote').textContent=url; }
    };
    if(window.QRCode){ new QRCode(layer.querySelector('#qr'), {text: location.href.split('#')[0], width:220, height:220}); }
    else{ layer.querySelector('#qr').textContent = location.href.split('#')[0]; }
  });

  function ensurePlay(video){ video.play().catch(()=>{ video.controls=true; }); }

  // ===== 互動（點擊才出現效果） =====
  // A 能量瓶
  (function(){
    const badge = document.getElementById('badge1');
    const fill = document.getElementById('energyFill');
    const full = document.getElementById('energyFull');
    const pbar = badge.querySelector('.pbar');
    let clicks=0, cooling=false;
    const run = ()=>{
      if(cooling) return; cooling=true;
      pbar.style.display='block'; requestAnimationFrame(()=>{ fill.style.width='100%'; });
      setTimeout(()=>{ fill.style.width='0%'; pbar.style.display='none'; cooling=false; }, 1100);
      clicks++; if(clicks%3===0){ full.style.display='inline-block'; makeBurst(badge, 12); toast('已補滿，出發吧！', 1200); setTimeout(()=> full.style.display='none', 900); }
    };
    badge.addEventListener('click', run);
    badge.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') {e.preventDefault(); run();}});
  })();

  // B 天氣
  (function(){
    const badge = document.getElementById('badge2');
    const face = document.getElementById('weatherFace');
    const stamp = document.getElementById('weatherStamp');
    const states = ['🌥️','☀️','🌈']; let i=0;
    const run = ()=>{ i=(i+1)%states.length; face.textContent=states[i];
      stamp.style.opacity=1; stamp.style.transform='scale(1)';
      setTimeout(()=>{ stamp.style.opacity=0; stamp.style.transform='scale(.9)'; }, 850);
      if(states[i]==='🌈') makeBurst(badge, 12);
    };
    badge.addEventListener('click', run);
    badge.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') {e.preventDefault(); run();}});
  })();

  // C 花束
  (function(){
    const badge = document.getElementById('badge3');
    const face = document.getElementById('bouquetFace');
    const shield = document.getElementById('bouquetShield');
    const variants = [{emo:'💪', label:'元氣'},{emo:'🫶', label:'溫柔'},{emo:'🌟', label:'閃亮'}];
    let idx=-1, clicks=0;
    const run = ()=>{ clicks++; if(clicks%3===0){ idx=(idx+1)%variants.length; const v=variants[idx];
      face.textContent=v.emo; toast('花束升級：' + v.label, 1200);
      shield.style.opacity=1; shield.style.transform='translateY(0)'; makeBurst(badge, 10);
      setTimeout(()=>{ shield.style.opacity=0; shield.style.transform='translateY(6px)' }, 900);
    }};
    badge.addEventListener('click', run);
    badge.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') {e.preventDefault(); run();}});
  })();

  // D 禮物
  (function(){
    const badge = document.getElementById('badge4');
    const box = document.getElementById('giftBox');
    const note = document.getElementById('giftNote');
    let opened=false, noteShown=false;
    const run = ()=>{ opened=!opened; box.classList.toggle('open', opened);
      if(opened){ makeBurst(badge, 14); }
      else if(!noteShown){ noteShown=true; note.style.opacity=1; note.style.top='-64px'; setTimeout(()=>{ note.style.opacity=0; note.style.top='-50px' }, 600); }
    };
    badge.addEventListener('click', run);
    badge.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') {e.preventDefault(); run();}});
  })();

  // 啟動
  show(0);
})();
</script>
</body>
</html>
