<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ÊÑüË¨ùÂç°</title>
<style>
:root{--bg:#fff8ec;--ink:#2b2b2b;--paper:#fffef9;--accent:#ffd24d;--heart:#ff7aa2;}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 800px at 20% 20%,#fffaf0,var(--bg));color:var(--ink);
font-family:ui-rounded,"SF Pro Rounded","Noto Sans TC","Segoe UI",system-ui,-apple-system,"PingFang TC","Helvetica Neue",Arial,sans-serif;
display:flex;align-items:center;justify-content:center;overflow:hidden}
.stage{position:relative;width:min(960px,94vw);height:min(640px,92vh);}
.env-wrap{position:absolute;inset:0;display:grid;place-items:center;transition:opacity .6s ease,transform .6s ease;}
.envelope{position:relative;width:360px;height:230px;cursor:pointer;transform-origin:50% 70%;animation:floaty 2.8s ease-in-out infinite;}
.env-body{position:absolute;inset:0;background:#fff;border-radius:14px;box-shadow:0 16px 50px rgba(0,0,0,.12),0 3px 8px rgba(0,0,0,.06);background:linear-gradient(#fff,#f5f5f5);}
.env-flap{position:absolute;left:0;right:0;top:0;height:62%;background:linear-gradient(#ffe27a,#ffd24d);
clip-path:polygon(0 0,100% 0,50% 100%);transform-origin:50% 0;border-top-left-radius:14px;border-top-right-radius:14px;transition:transform .8s cubic-bezier(.2,.9,.2,1.2);}
.heart{position:absolute;left:50%;top:58%;width:44px;height:44px;transform:translate(-50%,-50%) rotate(45deg);}
.heart::before,.heart::after{content:"";position:absolute;inset:0;background:var(--heart);border-radius:10px}
.heart::before{width:50%;left:0;}.heart::after{height:50%;top:-50%;left:0;width:100%;border-radius:50%;}
@keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.card{position:absolute;inset:0;display:grid;place-items:center;opacity:0;pointer-events:none;transform:translateY(10px) scale(.98);transition:opacity .7s ease,transform .7s ease;}
.card.show{opacity:1;pointer-events:auto;transform:translateY(0) scale(1);}
.paper{width:min(900px,94vw);height:min(600px,90vh);background:var(--paper);border-radius:20px;box-shadow:0 18px 60px rgba(0,0,0,.12),0 4px 16px rgba(0,0,0,.06);position:relative;overflow:hidden;}
.pages{position:absolute;inset:0;}
.page{position:absolute;inset:0;padding:36px clamp(16px,4vw,56px);opacity:0;transform:translateY(10px) rotate(-.4deg);transition:opacity .45s ease,transform .45s ease;overflow:auto;}
.page.active{opacity:1;transform:translateY(0) rotate(0);}
.center{display:grid;place-items:center;text-align:center;height:100%}
.btns{position:absolute;right:16px;bottom:16px;display:flex;gap:10px;flex-wrap:wrap}
button{appearance:none;border:none;padding:.7rem 1rem;border-radius:12px;font-weight:600;cursor:pointer;background:#111;color:#fff;box-shadow:0 6px 20px rgba(0,0,0,.15);}
button.ghost{background:#ffe27a;color:#3b2a00}
button:active{transform:translateY(1px) scale(.99)}
pre.ascii{white-space:pre;line-height:1.05;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
font-size:clamp(10px,1.6vw,14px);background:#fffdf6;padding:16px;border-radius:12px;box-shadow:inset 0 0 0 1px #f3edd7;max-height:60vh;overflow:auto;user-select:text;}
.grid4{display:grid;grid-template-columns:repeat(2,minmax(180px,1fr));gap:18px;margin-top:6px;}
.badge{position:relative;display:grid;place-items:center;background:#fffdf3;border:1px solid #f0e6c6;border-radius:18px;padding:14px;cursor:pointer;transition:transform .05s ease,box-shadow .2s ease;}
.badge:active{transform:translateY(1px) scale(.99)}
.badge img{width:170px;height:170px;object-fit:contain;display:block}
.popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.38);z-index:9999;}
.popup.show{display:flex;}
.popup-card{background:#fff;color:#222;padding:24px 26px;border-radius:16px;box-shadow:0 16px 44px rgba(0,0,0,.28);
max-width:min(92vw,720px);width:min(92vw,720px);text-align:center;font-size:clamp(18px,2.6vw,24px);line-height:1.6;}
.popup button{margin-top:14px;background:#111;color:#fff;border:none;padding:.7rem 1.1rem;border-radius:12px;cursor:pointer;font-weight:700}
.confetti{position:absolute;inset:0;pointer-events:none;overflow:hidden;}
.piece{position:absolute;width:10px;height:16px;opacity:0;animation:confetti 1600ms ease forwards;}
@keyframes confetti{0%{transform:translate(var(--sx), -20px) rotate(0deg); opacity:0;} 10%{opacity:1;} 100%{ transform:translate(var(--ex), 100vh) rotate(720deg); opacity:0;}}
.spark{position:absolute;font-size:18px;animation:fly 900ms ease-out forwards;pointer-events:none;}
@keyframes fly{from{opacity:1;transform:translate(var(--x,0),var(--y,0)) scale(1);} to{opacity:0;transform:translate(calc(var(--x,0)*2.2),calc(var(--y,0)*2.2)) scale(1.5);}}
</style>
</head>
<body>
<div class="stage">
  <div class="env-wrap" id="envIntro">
    <div class="envelope" id="envBtn" aria-label="ÈñãÂïü">
      <div class="env-body"></div>
      <div class="env-flap"></div>
      <div class="heart"></div>
    </div>
  </div>

  <div class="card" id="card">
    <div class="paper">
      <div class="pages">
        <section class="page center active" id="pg1">
          <div><pre id="ascii" class="ascii" aria-live="polite"> </pre></div>
        </section>
        <section class="page center" id="pg2">
          <img id="msgImg" src="" alt="" style="max-width:min(760px,85vw);max-height:52vh;border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,.12);" />
        </section>
        <section class="page" id="pg3">
          <div class="grid4" id="pikaGrid">
            <div class="badge" data-msg="Â∑•‰ΩúËæõËã¶‰∫ÜÔºåÂä†Ê≤π üí™‚ú®"><img src="pika1.png" alt=""></div>
            <div class="badge" data-msg="Â∑•‰Ωú‰∏ÄÂàáÈ†ÜÂà©ÔΩû üåà"><img src="pika2.png" alt=""></div>
            <div class="badge" data-msg="Â∏åÊúõ‰ªäÂ§©Ê≤íÊúâÁ™ÅÁôºÁãÄÊ≥ÅÔºåÊòØÈ†ÜÂøÉÂ•ΩÊó•Â≠êÔºÅüçÄ"><img src="pika3.png" alt=""></div>
            <div class="badge" data-msg="Âëà‰∏äÁúüÂøÉÁöÑËê¨ÂàÜÊÑüË¨ù ‚ú®‚≠êÔ∏è‚ù§Ô∏è"><img src="pika4.png" alt=""></div>
          </div>
        </section>
        <section class="page center" id="pg4"><div></div></section>
      </div>
      <div class="btns">
        <button id="prev">‰∏ä‰∏ÄÈ†Å</button>
        <button class="ghost" id="next">‰∏ã‰∏ÄÈ†Å</button>
        <button id="finish">ÈóúÈñâ‰ø°Â∞Å</button>
      </div>
      <div class="confetti" id="confetti"></div>
    </div>
  </div>
</div>

<div class="popup" id="popup" aria-live="polite" aria-modal="true" role="dialog">
  <div class="popup-card">
    <div id="popupText"></div>
    <button id="popupOk">pika~</button>
  </div>
</div>

<script>
(function(){
  const envWrap = document.getElementById('envIntro');
  const envBtn = document.getElementById('envBtn');
  const flap = envBtn.querySelector('.env-flap');
  const card = document.getElementById('card');
  envBtn.addEventListener('click', ()=>{
    flap.style.transform='rotateX(175deg)';
    envWrap.style.opacity='0'; envWrap.style.transform='translateY(-10px) scale(.98)';
    setTimeout(()=>{ envWrap.style.display='none'; card.classList.add('show'); fireConfetti(60); }, 500);
  });

  // ASCII animation or typewriter
  const asciiEl = document.getElementById('ascii');
  fetch('ascii_frames.txt').then(r=> r.ok ? r.text() : Promise.reject()).then(text=>{
    const frames = text.split(/\n\s*===FRAME===\s*\n/gm);
    let i=0; function showFrame(){ asciiEl.textContent = frames[i++ % frames.length]; }
    showFrame(); setInterval(showFrame, 280);
  }).catch(()=>{
    fetch('ascii_pikachu.txt').then(r=>r.text()).then(t=> typewriter(asciiEl, t));
  });
  function typewriter(el, text){ let i=0; el.textContent=''; (function step(){ el.textContent = text.slice(0, i++); if(i<=text.length) requestAnimationFrame(step); })(); }

  // periodic sparks near ASCII
  setInterval(()=> sparks(asciiEl, 6), 2200);
  function sparks(target, n=6){
    const rect = target.getBoundingClientRect();
    for(let i=0;i<n;i++){
      const s=document.createElement('div'); s.className='spark'; s.textContent='‚ö°';
      const x=(Math.random()*rect.width - rect.width/2), y=(Math.random()*rect.height - rect.height/2);
      s.style.position='fixed';
      s.style.left=(rect.left + rect.width/2) + 'px'; s.style.top=(rect.top + rect.height/2 + window.scrollY) + 'px';
      s.style.setProperty('--x', x+'px'); s.style.setProperty('--y', y+'px');
      document.body.appendChild(s); setTimeout(()=> s.remove(), 950);
    }
  }

  // Message image loader
  const msgImg = document.getElementById('msgImg');
  const candidates = ['message.png','message.jpg','message.jpeg','message.webp','message.svg'];
  let ci = 0; function tryNext(){ if(ci >= candidates.length) return; msgImg.src = candidates[ci++]; }
  msgImg.onerror = tryNext; tryNext();

  // Pages
  const pages=[...document.querySelectorAll('.page')]; let idx=0;
  const next=document.getElementById('next'); const prev=document.getElementById('prev'); const finish=document.getElementById('finish');
  function show(i){ pages[idx].classList.remove('active'); idx=Math.max(0,Math.min(pages.length-1,i)); pages[idx].classList.add('active'); next.style.display= idx===pages.length-1?'none':'inline-block'; finish.style.display= idx===pages.length-1?'inline-block':'none'; }
  show(0); prev.addEventListener('click',()=> show(idx-1)); next.addEventListener('click',()=>{ show(idx+1); if(idx===1) fireConfetti(40); });
  finish.addEventListener('click',()=>{ card.classList.remove('show'); envWrap.style.display='grid'; setTimeout(()=>{ envWrap.style.opacity='1'; envWrap.style.transform='none'; flap.style.transform='rotateX(0deg)'; },20); fireConfetti(120); });

  // Modal
  const popup = document.getElementById('popup'), popupText = document.getElementById('popupText'), popupOk = document.getElementById('popupOk');
  function showModal(text){ popupText.textContent = text; popup.classList.add('show'); popupOk.focus(); }
  popupOk.addEventListener('click', ()=> popup.classList.remove('show'));
  popup.addEventListener('click', e=>{ if(e.target === popup) popup.classList.remove('show'); });

  // click bindings
  document.querySelectorAll('.badge').forEach(b=> b.addEventListener('click', ()=> showModal(b.getAttribute('data-msg')||'')));

  // Confetti
  const confetti = document.getElementById('confetti');
  function fireConfetti(n=80){
    for(let i=0;i<n;i++){
      const p=document.createElement('div'); p.className='piece';
      p.style.left=Math.random()*100+'%';
      p.style.background=['#ffd24d','#ff7aa2','#7dd3fc','#b1f0dc','#fca5a5'][i%5];
      const sx=(Math.random()*100-50)+'vw'; const ex=(Math.random()*100-50)+'vw';
      p.style.setProperty('--sx', sx); p.style.setProperty('--ex', ex);
      p.style.animationDelay=(Math.random()*300)+'ms';
      confetti.appendChild(p); setTimeout(()=> p.remove(), 2000);
    }
  }
})();
</script>
</body>
</html>
